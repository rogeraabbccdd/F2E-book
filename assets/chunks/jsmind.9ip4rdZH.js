var Y=Object.defineProperty;var $=(w,y,g)=>y in w?Y(w,y,{enumerable:!0,configurable:!0,writable:!0,value:g}):w[y]=g;var j=(w,y,g)=>($(w,typeof y!="symbol"?y+"":y,g),g);import{g as J,c as q}from"./theme.D__huRmo.js";function G(w,y){for(var g=0;g<y.length;g++){const h=y[g];if(typeof h!="string"&&!Array.isArray(h)){for(const v in h)if(v!=="default"&&!(v in w)){const x=Object.getOwnPropertyDescriptor(h,v);x&&Object.defineProperty(w,v,x.get?x:{enumerable:!0,get:()=>h[v]})}}}return Object.freeze(Object.defineProperty(w,Symbol.toStringTag,{value:"Module"}))}var P={exports:{}};/**
* @license BSD-3-Clause
* @copyright 2014-2023 hizzgdev@163.com
*
* Project Home:
*   https://github.com/hizzgdev/jsmind/
*/(function(w,y){(function(g,h){w.exports=h()})(q,function(){const g="0.8.3";typeof String.prototype.startsWith!="function"&&(String.prototype.startsWith=function(s){return this.slice(0,s.length)===s});const h={left:-1,center:0,right:1,of:function(s){return s&&s!==-1&&s!==0&&s!==1?s==="-1"||s==="0"||s==="1"?parseInt(s):s.toLowerCase()==="left"?this.left:s.toLowerCase()==="right"?this.right:s.toLowerCase()==="center"?this.center:void 0:s}},v={show:1,resize:2,edit:3,select:4},x={debug:1,info:2,warn:3,error:4,disable:9};var b=function(){};let d=typeof console>"u"?{level:b,log:b,debug:b,info:b,warn:b,error:b}:{level:function(s){d.debug=s>x.debug?b:console.debug,d.info=s>x.info?b:console.info,d.warn=s>x.warn?b:console.warn,d.error=s>x.error?b:console.error},log:console.log,debug:console.debug,info:console.info,warn:console.warn,error:console.error};const _=new class{constructor(s){this.w=s,this.d=s.document,this.g=function(e){return this.d.getElementById(e)},this.c=function(e){return this.d.createElement(e)},this.t=function(e,t){e.hasChildNodes()?e.firstChild.nodeValue=t:e.appendChild(this.d.createTextNode(t))},this.h=function(e,t){t instanceof HTMLElement?(e.innerHTML="",e.appendChild(t)):e.innerHTML=t},this.i=function(e){return!!e&&typeof e=="object"&&e.nodeType===1&&typeof e.style=="object"&&typeof e.ownerDocument=="object"},this.on=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}}}(window),z={file:{read:function(s,e){var t=new FileReader;t.onload=function(){typeof e=="function"&&e(this.result,s.name)},t.readAsText(s)},save:function(s,e,t){var i;if(typeof _.w.Blob=="function")i=new Blob([s],{type:e});else{var n=new(_.w.BlobBuilder||_.w.MozBlobBuilder||_.w.WebKitBlobBuilder||_.w.MSBlobBuilder);n.append(s),i=n.getBlob(e)}if(navigator.msSaveBlob)navigator.msSaveBlob(i,t);else{var o=(_.w.URL||_.w.webkitURL).createObjectURL(i),r=_.c("a");if("download"in r){r.style.visibility="hidden",r.href=o,r.download=t,_.d.body.appendChild(r);var a=_.d.createEvent("MouseEvents");a.initEvent("click",!0,!0),r.dispatchEvent(a),_.d.body.removeChild(r)}else location.href=o}}},json:{json2string:function(s){return JSON.stringify(s)},string2json:function(s){return JSON.parse(s)},merge:function(s,e){for(var t in e)t in s?typeof s[t]!="object"||Object.prototype.toString.call(s[t]).toLowerCase()!="[object object]"||s[t].length?s[t]=e[t]:z.json.merge(s[t],e[t]):s[t]=e[t];return s}},uuid:{newid:function(){return(new Date().getTime().toString(16)+Math.random().toString(16).substring(2)).substring(2,18)}},text:{is_empty:function(s){return!s||s.replace(/\s*/,"").length==0}}},W={container:"",editable:!1,theme:null,mode:"full",support_html:!0,log_level:"info",view:{engine:"canvas",hmargin:100,vmargin:50,line_width:2,line_color:"#555",line_style:"curved",draggable:!1,hide_scrollbars_when_draggable:!1,node_overflow:"hidden",zoom:{min:.5,max:2.1,step:.1},custom_node_render:null,expander_style:"char"},layout:{hspace:30,vspace:20,pspace:13,cousin_space:0},default_event_handle:{enable_mousedown_handle:!0,enable_click_handle:!0,enable_dblclick_handle:!0,enable_mousewheel_handle:!0},shortcut:{enable:!0,handles:{},mapping:{addchild:[45,4109],addbrother:13,editnode:113,delnode:46,toggle:32,left:37,up:38,right:39,down:40}},plugin:{}};class c{constructor(e,t,i,n,o,r,a,l){e?typeof t=="number"?(l===void 0&&(l=!0),this.id=e,this.index=t,this.topic=i,this.data=n||{},this.isroot=o,this.parent=r,this.direction=a,this.expanded=!!l,this.children=[],this._data={}):d.error("invalid node index"):d.error("invalid node id")}get_location(){var e=this._data.view;return{x:e.abs_x,y:e.abs_y}}get_size(){var e=this._data.view;return{w:e.width,h:e.height}}static compare(e,t){var i=e.index,n=t.index;return i>=0&&n>=0?i-n:i==-1&&n==-1?0:i==-1?1:n==-1?-1:0}static inherited(e,t){if(e&&t){if(e.id===t.id||e.isroot)return!0;for(var i=e.id,n=t;!n.isroot;)if((n=n.parent).id===i)return!0}return!1}static is_node(e){return!!e&&e instanceof c}}class k{constructor(){this.name=null,this.author=null,this.version=null,this.root=null,this.selected=null,this.nodes={}}get_node(e){return e in this.nodes?this.nodes[e]:(d.warn("the node[id="+e+"] can not be found"),null)}set_root(e,t,i){return this.root==null?(this.root=new c(e,0,t,i,!0),this._put_node(this.root),this.root):(d.error("root node is already exist"),null)}add_node(e,t,i,n,o,r,a){if(!c.is_node(e))return d.error("the parent_node "+e+" is not a node."),null;var l=new c(t,a||-1,i,n,!1,e,e.direction,r);return e.isroot&&(l.direction=o||h.right),this._put_node(l)?(e.children.push(l),this._update_index(e)):(d.error("fail, the node id '"+l.id+"' has been already exist."),l=null),l}insert_node_before(e,t,i,n,o){if(!c.is_node(e))return d.error("the node_before "+e+" is not a node."),null;var r=e.index-.5;return this.add_node(e.parent,t,i,n,o,!0,r)}get_node_before(e){if(!c.is_node(e)){var t=this.get_node(e);return t?this.get_node_before(t):(d.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;var i=e.index-2;return i>=0?e.parent.children[i]:null}insert_node_after(e,t,i,n,o){if(!c.is_node(e))return d.error("the node_after "+e+" is not a node."),null;var r=e.index+.5;return this.add_node(e.parent,t,i,n,o,!0,r)}get_node_after(e){if(!c.is_node(e)){var t=this.get_node(e);return t?this.get_node_after(t):(d.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;var i=e.index;return e.parent.children.length>i?e.parent.children[i]:null}move_node(e,t,i,n){return c.is_node(e)?(i||(i=e.parent.id),this._move_node(e,t,i,n)):(d.error("the parameter node "+e+" is not a node."),null)}_flow_node_direction(e,t){t===void 0?t=e.direction:e.direction=t;for(var i=e.children.length;i--;)this._flow_node_direction(e.children[i],t)}_move_node_internal(e,t){if(e&&t)if(t=="_last_")e.index=-1,this._update_index(e.parent);else if(t=="_first_")e.index=0,this._update_index(e.parent);else{var i=t?this.get_node(t):null;i!=null&&i.parent!=null&&i.parent.id==e.parent.id&&(e.index=i.index-.5,this._update_index(e.parent))}return e}_move_node(e,t,i,n){if(e&&i){var o=this.get_node(i);if(c.inherited(e,o))return d.error("can not move a node to its children"),null;if(e.parent.id!=i){for(var r=e.parent.children,a=r.length;a--;)if(r[a].id==e.id){r.splice(a,1);break}let l=e.parent;e.parent=o,o.children.push(e),this._update_index(l)}e.parent.isroot?n==h.left?e.direction=n:e.direction=h.right:e.direction=e.parent.direction,this._move_node_internal(e,t),this._flow_node_direction(e)}return e}remove_node(e){if(!c.is_node(e))return d.error("the parameter node "+e+" is not a node."),!1;if(e.isroot)return d.error("fail, can not remove root node"),!1;this.selected!=null&&this.selected.id==e.id&&(this.selected=null);for(var t=e.children,i=t.length;i--;)this.remove_node(t[i]);t.length=0;for(var n=e.parent,o=n.children,r=o.length;r--;)if(o[r].id==e.id){o.splice(r,1);break}for(var a in delete this.nodes[e.id],e)delete e[a];return e=null,this._update_index(n),!0}_put_node(e){return e.id in this.nodes?(d.warn("the node_id '"+e.id+"' has been already exist."),!1):(this.nodes[e.id]=e,!0)}_update_index(e){if(e instanceof c){e.children.sort(c.compare);for(var t=0;t<e.children.length;t++)e.children[t].index=t+1}}}const C={name:"jsMind",author:"hizzgdev@163.com",version:g},u={node_tree:{example:{meta:C,format:"node_tree",data:{id:"root",topic:"jsMind node_tree example"}},get_mind:function(s){var e=u.node_tree,t=new k;return t.name=s.meta.name,t.author=s.meta.author,t.version=s.meta.version,e._parse(t,s.data),t},get_data:function(s){var e=u.node_tree,t={};return t.meta={name:s.name,author:s.author,version:s.version},t.format="node_tree",t.data=e._build_node(s.root),t},_parse:function(s,e){var t=u.node_tree,i=t._extract_data(e);if(s.set_root(e.id,e.topic,i),"children"in e)for(var n=e.children,o=0;o<n.length;o++)t._extract_subnode(s,s.root,n[o])},_extract_data:function(s){var e={};for(var t in s)t!="id"&&t!="topic"&&t!="children"&&t!="direction"&&t!="expanded"&&(e[t]=s[t]);return e},_extract_subnode:function(s,e,t){var i=u.node_tree,n=i._extract_data(t),o=null;e.isroot&&(o=t.direction=="left"?h.left:h.right);var r=s.add_node(e,t.id,t.topic,n,o,t.expanded);if(t.children)for(var a=t.children,l=0;l<a.length;l++)i._extract_subnode(s,r,a[l])},_build_node:function(s){var e=u.node_tree;if(s instanceof c){var t={id:s.id,topic:s.topic,expanded:s.expanded};if(s.parent&&s.parent.isroot&&(t.direction=s.direction==h.left?"left":"right"),s.data!=null){var i=s.data;for(var n in i)t[n]=i[n]}var o=s.children;if(o.length>0){t.children=[];for(var r=0;r<o.length;r++)t.children.push(e._build_node(o[r]))}return t}}},node_array:{example:{meta:C,format:"node_array",data:[{id:"root",topic:"jsMind node_array example",isroot:!0}]},get_mind:function(s){var e=u.node_array,t=new k;return t.name=s.meta.name,t.author=s.meta.author,t.version=s.meta.version,e._parse(t,s.data),t},get_data:function(s){var e=u.node_array,t={};return t.meta={name:s.name,author:s.author,version:s.version},t.format="node_array",t.data=[],e._array(s,t.data),t},_parse:function(s,e){var t=u.node_array,i=e.slice(0);i.reverse();var n=t._extract_root(s,i);n?t._extract_subnode(s,n,i):d.error("root node can not be found")},_extract_root:function(s,e){for(var t=u.node_array,i=e.length;i--;)if("isroot"in e[i]&&e[i].isroot){var n=e[i],o=t._extract_data(n),r=s.set_root(n.id,n.topic,o);return e.splice(i,1),r}return null},_extract_subnode:function(s,e,t){for(var i=u.node_array,n=t.length,o=null,r=null,a=0;n--;)if((o=t[n]).parentid==e.id){r=i._extract_data(o);var l=null,p=o.direction;p&&(l=p=="left"?h.left:h.right);var f=s.add_node(e,o.id,o.topic,r,l,o.expanded);t.splice(n,1),a++;var N=i._extract_subnode(s,f,t);N>0&&(n=t.length,a+=N)}return a},_extract_data:function(s){var e={};for(var t in s)t!="id"&&t!="topic"&&t!="parentid"&&t!="isroot"&&t!="direction"&&t!="expanded"&&(e[t]=s[t]);return e},_array:function(s,e){u.node_array._array_node(s.root,e)},_array_node:function(s,e){var t=u.node_array;if(s instanceof c){var i={id:s.id,topic:s.topic,expanded:s.expanded};if(s.parent&&(i.parentid=s.parent.id),s.isroot&&(i.isroot=!0),s.parent&&s.parent.isroot&&(i.direction=s.direction==h.left?"left":"right"),s.data!=null){var n=s.data;for(var o in n)i[o]=n[o]}e.push(i);for(var r=s.children.length,a=0;a<r;a++)t._array_node(s.children[a],e)}}},freemind:{example:{meta:C,format:"freemind",data:'<map version="1.0.1"><node ID="root" TEXT="jsMind freemind example"/></map>'},get_mind:function(s){var e=u.freemind,t=new k;t.name=s.meta.name,t.author=s.meta.author,t.version=s.meta.version;var i=s.data,n=e._parse_xml(i),o=e._find_root(n);return e._load_node(t,null,o),t},get_data:function(s){var e=u.freemind,t={};t.meta={name:s.name,author:s.author,version:s.version},t.format="freemind";var i=[];return i.push('<map version="1.0.1">'),e._build_map(s.root,i),i.push("</map>"),t.data=i.join(""),t},_parse_xml:function(s){var e=null;return window.DOMParser?e=new DOMParser().parseFromString(s,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async=!1,e.loadXML(s)),e},_find_root:function(s){for(var e=s.childNodes,t=null,i=null,n=0;n<e.length;n++)if((i=e[n]).nodeType==1&&i.tagName=="map"){t=i;break}if(t){var o=t.childNodes;for(t=null,n=0;n<o.length;n++)if((i=o[n]).nodeType==1&&i.tagName=="node"){t=i;break}}return t},_load_node:function(s,e,t){var i=u.freemind,n=t.getAttribute("ID"),o=t.getAttribute("TEXT"),r=t.getAttribute("FOLDED");if(o==null){for(var a=t.childNodes,l=null,p=0;p<a.length;p++)if((l=a[p]).nodeType==1&&l.tagName==="richcontent"){o=l.textContent;break}}var f=i._load_attributes(t),N="expanded"in f?f.expanded=="true":r!="true";delete f.expanded;var I=t.getAttribute("POSITION"),S=null;I&&(S=I=="left"?h.left:h.right);var D=null;D=e?s.add_node(e,n,o,f,S,N):s.set_root(n,o,f);var O=t.childNodes,L=null;for(p=0;p<O.length;p++)(L=O[p]).nodeType==1&&L.tagName=="node"&&i._load_node(s,D,L)},_load_attributes:function(s){for(var e=s.childNodes,t=null,i={},n=0;n<e.length;n++)(t=e[n]).nodeType==1&&t.tagName==="attribute"&&(i[t.getAttribute("NAME")]=t.getAttribute("VALUE"));return i},_build_map:function(s,e){var t=u.freemind,i=null;s.parent&&s.parent.isroot&&(i=s.direction===h.left?"left":"right"),e.push("<node"),e.push(' ID="'+s.id+'"'),i&&e.push(' POSITION="'+i+'"'),s.expanded||e.push(' FOLDED="true"'),e.push(' TEXT="'+t._escape(s.topic)+'">');var n=s.data;if(n!=null)for(var o in n)e.push('<attribute NAME="'+o+'" VALUE="'+n[o]+'"/>');for(var r=s.children,a=0;a<r.length;a++)t._build_map(r[a],e);e.push("</node>")},_escape:function(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}},text:{example:{meta:C,format:"text",data:`jsMind text example
 node1
  node1-sub
  node1-sub
 node2`},_line_regex:/\s*/,get_mind:function(s){var e=u.text,t=new k;t.name=s.meta.name,t.author=s.meta.author,t.version=s.meta.version;var i=s.data.split(/\n|\r/);return e._fill_nodes(t,i,0,0),t},_fill_nodes:function(s,e){let t=[],i=0;for(;i<e.length;){let n=e[i],o=n.match(/\s*/)[0].length,r=n.substr(o);if(o==0&&t.length>0)return void log.error("more than 1 root node was found: "+r);if(o>t.length)return void log.error("a suspended node was found: "+r);let a=t.length-o;for(;a--;)t.pop();if(o==0&&t.length==0){let l=s.set_root(z.uuid.newid(),r);t.push(l)}else{let l=s.add_node(t[o-1],z.uuid.newid(),r,{},null);t.push(l)}i++}t.length=0},get_data:function(s){var e=u.text,t={};t.meta={name:s.name,author:s.author,version:s.version},t.format="text";let i=[];return e._build_lines(i,[s.root],0),t.data=i.join(`
`),t},_build_lines:function(s,e,t){let i=new Array(t+1).join(" ");for(let n of e)s.push(i+n.topic),n.children&&u.text._build_lines(s,n.children,t+1)}}};class H{constructor(e){this.jm=e}init(){d.debug("data.init")}reset(){d.debug("data.reset")}load(e){var t=null,i=null;return(t=typeof e=="object"?e.format?e.format:"node_tree":"freemind")=="node_array"?i=u.node_array.get_mind(e):t=="node_tree"?i=u.node_tree.get_mind(e):t=="freemind"?i=u.freemind.get_mind(e):t=="text"?i=u.text.get_mind(e):d.warn("unsupported format"),i}get_data(e){var t=null;return e=="node_array"?t=u.node_array.get_data(this.jm.mind):e=="node_tree"?t=u.node_tree.get_data(this.jm.mind):e=="freemind"?t=u.freemind.get_data(this.jm.mind):e=="text"?t=u.text.get_data(this.jm.mind):d.error("unsupported "+e+" format"),t}}class X{constructor(e,t){this.opts=t,this.jm=e,this.isside=this.opts.mode=="side",this.bounds=null,this.cache_valid=!1}init(){d.debug("layout.init")}reset(){d.debug("layout.reset"),this.bounds={n:0,s:0,w:0,e:0}}calculate_next_child_direction(e){if(this.isside)return h.right;for(var t=e.children||[],i=t.length,n=0,o=0;o<i;o++)t[o].direction===h.left?n--:n++;return i>1&&n>0?h.left:h.right}layout(){d.debug("layout.layout"),this.layout_direction(),this.layout_offset()}layout_direction(){this._layout_direction_root()}_layout_direction_root(){var e=this.jm.mind.root,t=null;"layout"in e._data?t=e._data.layout:(t={},e._data.layout=t);var i=e.children,n=i.length;if(t.direction=h.center,t.side_index=0,this.isside)for(var o=n;o--;)this._layout_direction_side(i[o],h.right,o);else{o=n;for(var r=null;o--;)(r=i[o]).direction==h.left?this._layout_direction_side(r,h.left,o):this._layout_direction_side(r,h.right,o)}}_layout_direction_side(e,t,i){var n=null;"layout"in e._data?n=e._data.layout:(n={},e._data.layout=n);var o=e.children,r=o.length;n.direction=t,n.side_index=i;for(var a=r;a--;)this._layout_direction_side(o[a],t,a)}layout_offset(){var e=this.jm.mind.root,t=e._data.layout;t.offset_x=0,t.offset_y=0,t.outer_height=0;for(var i=e.children,n=i.length,o=[],r=[],a=null;n--;)(a=i[n])._data.layout.direction==h.right?r.unshift(a):o.unshift(a);t.left_nodes=o,t.right_nodes=r,t.outer_height_left=this._layout_offset_subnodes(o),t.outer_height_right=this._layout_offset_subnodes(r),this.bounds.e=e._data.view.width/2,this.bounds.w=0-this.bounds.e,this.bounds.n=0,this.bounds.s=Math.max(t.outer_height_left,t.outer_height_right)}_layout_offset_subnodes(e){for(var t=0,i=e.length,n=i,o=null,r=0,a=null,l=0,p=null;n--;)a=(o=e[n])._data.layout,p==null&&(p=o.parent._data),r=this._layout_offset_subnodes(o.children),o.expanded||(r=0,this.set_visible(o.children,!1)),r=Math.max(o._data.view.height,r),o.children.length>1&&(r+=this.opts.cousin_space),a.outer_height=r,a.offset_y=l-r/2,a.offset_x=this.opts.hspace*a.direction+p.view.width*(p.layout.direction+a.direction)/2,o.parent.isroot||(a.offset_x+=this.opts.pspace*a.direction),l=l-r-this.opts.vspace,t+=r;i>1&&(t+=this.opts.vspace*(i-1)),n=i;for(var f=t/2;n--;)(o=e[n])._data.layout.offset_y+=f;return t}_layout_offset_subnodes_height(e){for(var t=0,i=e.length,n=i,o=null,r=0,a=null,l=0,p=null;n--;)a=(o=e[n])._data.layout,p==null&&(p=o.parent._data),r=this._layout_offset_subnodes_height(o.children),o.expanded||(r=0),r=Math.max(o._data.view.height,r),o.children.length>1&&(r+=this.opts.cousin_space),a.outer_height=r,a.offset_y=l-r/2,l=l-r-this.opts.vspace,t+=r;i>1&&(t+=this.opts.vspace*(i-1)),n=i;for(var f=t/2;n--;)(o=e[n])._data.layout.offset_y+=f;return t}get_node_offset(e){var t=e._data.layout,i=null;if("_offset_"in t&&this.cache_valid?i=t._offset_:(i={x:-1,y:-1},t._offset_=i),i.x==-1||i.y==-1){var n=t.offset_x,o=t.offset_y;if(!e.isroot){var r=this.get_node_offset(e.parent);n+=r.x,o+=r.y}i.x=n,i.y=o}return i}get_node_point(e){var t=e._data.view,i=this.get_node_offset(e),n={};return n.x=i.x+t.width*(e._data.layout.direction-1)/2,n.y=i.y-t.height/2,n}get_node_point_in(e){return this.get_node_offset(e)}get_node_point_out(e){var t=e._data.layout,i=null;if("_pout_"in t&&this.cache_valid?i=t._pout_:(i={x:-1,y:-1},t._pout_=i),i.x==-1||i.y==-1)if(e.isroot)i.x=0,i.y=0;else{var n=e._data.view,o=this.get_node_offset(e);i.x=o.x+(n.width+this.opts.pspace)*e._data.layout.direction,i.y=o.y}return i}get_expander_point(e){var t=this.get_node_point_out(e),i={};return e._data.layout.direction==h.right?i.x=t.x-this.opts.pspace:i.x=t.x,i.y=t.y-Math.ceil(this.opts.pspace/2),i}get_min_size(){var e=this.jm.mind.nodes,t=null,i=null;for(var n in e)t=e[n],(i=this.get_node_point_out(t)).x>this.bounds.e&&(this.bounds.e=i.x),i.x<this.bounds.w&&(this.bounds.w=i.x);return{w:this.bounds.e-this.bounds.w,h:this.bounds.s-this.bounds.n}}toggle_node(e){e.isroot||(e.expanded?this.collapse_node(e):this.expand_node(e))}expand_node(e){e.expanded=!0,this.part_layout(e),this.set_visible(e.children,!0),this.jm.invoke_event_handle(v.show,{evt:"expand_node",data:[],node:e.id})}collapse_node(e){e.expanded=!1,this.part_layout(e),this.set_visible(e.children,!1),this.jm.invoke_event_handle(v.show,{evt:"collapse_node",data:[],node:e.id})}expand_all(){var e,t=this.jm.mind.nodes,i=0;for(var n in t)(e=t[n]).expanded||(e.expanded=!0,i++);if(i>0){var o=this.jm.mind.root;this.part_layout(o),this.set_visible(o.children,!0)}}collapse_all(){var e,t=this.jm.mind.nodes,i=0;for(var n in t)(e=t[n]).expanded&&!e.isroot&&(e.expanded=!1,i++);if(i>0){var o=this.jm.mind.root;this.part_layout(o),this.set_visible(o.children,!0)}}expand_to_depth(e,t,i){if(!(e<1))for(var n=t||this.jm.mind.root.children,o=i||1,r=n.length,a=null;r--;)a=n[r],o<e&&(a.expanded||this.expand_node(a),this.expand_to_depth(e,a.children,o+1)),o==e&&a.expanded&&this.collapse_node(a)}part_layout(e){var t=this.jm.mind.root;if(t){var i=t._data.layout;e.isroot?(i.outer_height_right=this._layout_offset_subnodes_height(i.right_nodes),i.outer_height_left=this._layout_offset_subnodes_height(i.left_nodes)):e._data.layout.direction==h.right?i.outer_height_right=this._layout_offset_subnodes_height(i.right_nodes):i.outer_height_left=this._layout_offset_subnodes_height(i.left_nodes),this.bounds.s=Math.max(i.outer_height_left,i.outer_height_right),this.cache_valid=!1}else d.warn("can not found root node")}set_visible(e,t){for(var i=e.length,n=null;i--;)(n=e[i])._data.layout,n.expanded?this.set_visible(n.children,t):this.set_visible(n.children,!1),n.isroot||(n._data.layout.visible=t)}is_expand(e){return e.expanded}is_visible(e){var t=e._data.layout;return!("visible"in t&&!t.visible)}}class M{constructor(e){this.view=e,this.opts=e.opts,this.e_svg=M.c("svg"),this.e_svg.setAttribute("class","jsmind"),this.size={w:0,h:0},this.lines=[],this.line_drawing={straight:this._line_to,curved:this._bezier_to},this.drawing=this.line_drawing[this.opts.line_style]||this.line_drawing.curved}static c(e){return _.d.createElementNS("http://www.w3.org/2000/svg",e)}element(){return this.e_svg}set_size(e,t){this.size.w=e,this.size.h=t,this.e_svg.setAttribute("width",e),this.e_svg.setAttribute("height",t)}clear(){for(var e=this.lines.length;e--;)this.e_svg.removeChild(this.lines[e]);this.lines.length=0}draw_line(e,t,i,n){var o=M.c("path");o.setAttribute("stroke",n||this.opts.line_color),o.setAttribute("stroke-width",this.opts.line_width),o.setAttribute("fill","transparent"),this.lines.push(o),this.e_svg.appendChild(o),this.drawing(o,t.x+i.x,t.y+i.y,e.x+i.x,e.y+i.y)}copy_to(e,t){var i=new Image;i.onload=function(){e.drawImage(i,0,0),t&&t()},i.src="data:image/svg+xml;base64,"+btoa(new XMLSerializer().serializeToString(this.e_svg))}_bezier_to(e,t,i,n,o){e.setAttribute("d","M "+t+" "+i+" C "+(t+2*(n-t)/3)+" "+i+", "+t+" "+o+", "+n+" "+o)}_line_to(e,t,i,n,o){e.setAttribute("d","M "+t+" "+i+" L "+n+" "+o)}}class R{constructor(e){this.opts=e.opts,this.e_canvas=_.c("canvas"),this.e_canvas.className="jsmind",this.canvas_ctx=this.e_canvas.getContext("2d"),this.size={w:0,h:0},this.line_drawing={straight:this._line_to,curved:this._bezier_to},this.drawing=this.line_drawing[this.opts.line_style]||this.line_drawing.curved}element(){return this.e_canvas}set_size(e,t){this.size.w=e,this.size.h=t,this.e_canvas.width=e,this.e_canvas.height=t}clear(){this.canvas_ctx.clearRect(0,0,this.size.w,this.size.h)}draw_line(e,t,i,n){var o=this.canvas_ctx;o.strokeStyle=n||this.opts.line_color,o.lineWidth=this.opts.line_width,o.lineCap="round",this.drawing(o,t.x+i.x,t.y+i.y,e.x+i.x,e.y+i.y)}copy_to(e,t){e.drawImage(this.e_canvas,0,0),t&&t()}_bezier_to(e,t,i,n,o){e.beginPath(),e.moveTo(t,i),e.bezierCurveTo(t+2*(n-t)/3,i,t,o,n,o),e.stroke()}_line_to(e,t,i,n,o){e.beginPath(),e.moveTo(t,i),e.lineTo(n,o),e.stroke()}}class F{constructor(e,t){this.opts=t,this.jm=e,this.layout=e.layout,this.container=null,this.e_panel=null,this.e_nodes=null,this.size={w:0,h:0},this.selected_node=null,this.editing_node=null,this.graph=null,this.render_node=t.custom_node_render?this._custom_node_render:this._default_node_render,this._initialized=!1}init(){if(d.debug(this.opts),d.debug("view.init"),this.container=_.i(this.opts.container)?this.opts.container:_.g(this.opts.container),this.container){var e;this.graph=(e=this,this.opts.engine.toLowerCase()==="svg"?new M(e):new R(e)),this.e_panel=_.c("div"),this.e_nodes=_.c("jmnodes"),this.e_editor=_.c("input"),this.e_panel.className="jsmind-inner jmnode-overflow-"+this.opts.node_overflow,this.e_panel.tabIndex=1,this.e_panel.appendChild(this.graph.element()),this.e_panel.appendChild(this.e_nodes),this.e_editor.className="jsmind-editor",this.e_editor.type="text",this.zoom_current=1;var t=this;_.on(this.e_editor,"keydown",function(i){var n=i||event;n.keyCode==13&&(t.edit_node_end(),n.stopPropagation())}),_.on(this.e_editor,"blur",function(i){t.edit_node_end()}),this.container.appendChild(this.e_panel),this.container.offsetParent||new IntersectionObserver((i,n)=>{i[0].isIntersecting&&(n.unobserve(this.e_panel),this.resize())}).observe(this.e_panel)}else d.error("the options.view.container was not be found in dom")}add_event(e,t,i,n){let o=n?this.e_panel:this.e_nodes;_.on(o,t,function(r){var a=r||event;i.call(e,a)})}get_binded_nodeid(e){if(e==null)return null;var t=e.tagName.toLowerCase();return t=="jmnode"||t=="jmexpander"?e.getAttribute("nodeid"):t=="jmnodes"||t=="body"||t=="html"?null:this.get_binded_nodeid(e.parentElement)}is_node(e){if(e==null)return!1;var t=e.tagName.toLowerCase();return t=="jmnode"||t!="jmnodes"&&t!="body"&&t!="html"&&this.is_node(e.parentElement)}is_expander(e){return e.tagName.toLowerCase()=="jmexpander"}reset(){d.debug("view.reset"),this.selected_node=null,this.clear_lines(),this.clear_nodes(),this.reset_theme()}reset_theme(){var e=this.jm.options.theme;this.e_nodes.className=e?"theme-"+e:""}reset_custom_style(){var e=this.jm.mind.nodes;for(var t in e)this.reset_node_custom_style(e[t])}load(){d.debug("view.load"),this.setup_canvas_draggable(this.opts.draggable),this.init_nodes(),this._initialized=!0}expand_size(){var e=this.layout.get_min_size(),t=e.w+2*this.opts.hmargin,i=e.h+2*this.opts.vmargin,n=this.e_panel.clientWidth,o=this.e_panel.clientHeight;n<t&&(n=t),o<i&&(o=i),this.size.w=n,this.size.h=o}init_nodes_size(e){var t=e._data.view;t.width=t.element.clientWidth,t.height=t.element.clientHeight}init_nodes(){var e=this.jm.mind.nodes,t=_.d.createDocumentFragment();for(var i in e)this.create_node_element(e[i],t);this.e_nodes.appendChild(t),this.run_in_c11y_mode_if_needed(()=>{for(var n in e)this.init_nodes_size(e[n])})}add_node(e){this.create_node_element(e,this.e_nodes),this.run_in_c11y_mode_if_needed(()=>{this.init_nodes_size(e)})}run_in_c11y_mode_if_needed(e){this.container.offsetParent?e():(d.warn("init nodes in compatibility mode. because the container or its parent has style {display:none}. "),this.e_panel.style.position="absolute",this.e_panel.style.top="-100000",_.d.body.appendChild(this.e_panel),e(),this.container.appendChild(this.e_panel),this.e_panel.style.position=null,this.e_panel.style.top=null)}create_node_element(e,t){var i=null;"view"in e._data?i=e._data.view:(i={},e._data.view=i);var n=_.c("jmnode");if(e.isroot)n.className="root";else{var o=_.c("jmexpander");_.t(o,"-"),o.setAttribute("nodeid",e.id),o.style.visibility="hidden",t.appendChild(o),i.expander=o}e.topic&&this.render_node(n,e),n.setAttribute("nodeid",e.id),n.style.visibility="hidden",this._reset_node_custom_style(n,e.data),t.appendChild(n),i.element=n}remove_node(e){this.selected_node!=null&&this.selected_node.id==e.id&&(this.selected_node=null),this.editing_node!=null&&this.editing_node.id==e.id&&(e._data.view.element.removeChild(this.e_editor),this.editing_node=null);for(var t=e.children,i=t.length;i--;)this.remove_node(t[i]);if(e._data.view){var n=e._data.view.element,o=e._data.view.expander;this.e_nodes.removeChild(n),this.e_nodes.removeChild(o),e._data.view.element=null,e._data.view.expander=null}}update_node(e){var t=e._data.view,i=t.element;if(e.topic&&this.render_node(i,e),this.layout.is_visible(e))t.width=i.clientWidth,t.height=i.clientHeight;else{let n=i.getAttribute("style");i.style="visibility: visible; left:0; top:0;",t.width=i.clientWidth,t.height=i.clientHeight,i.style=n}}select_node(e){if(this.selected_node){var t=this.selected_node._data.view.element;t.className=t.className.replace(/\s*selected\b/i,""),this.restore_selected_node_custom_style(this.selected_node)}e&&(this.selected_node=e,e._data.view.element.className+=" selected",this.clear_selected_node_custom_style(e))}select_clear(){this.select_node(null)}get_editing_node(){return this.editing_node}is_editing(){return!!this.editing_node}edit_node_begin(e){if(e.topic){this.editing_node!=null&&this.edit_node_end(),this.editing_node=e;var t=e._data.view.element,i=e.topic,n=getComputedStyle(t);this.e_editor.value=i,this.e_editor.style.width=t.clientWidth-parseInt(n.getPropertyValue("padding-left"))-parseInt(n.getPropertyValue("padding-right"))+"px",t.innerHTML="",t.appendChild(this.e_editor),t.style.zIndex=5,this.e_editor.focus(),this.e_editor.select()}else d.warn("don't edit image nodes")}edit_node_end(){if(this.editing_node!=null){var e=this.editing_node;this.editing_node=null;var t=e._data.view.element,i=this.e_editor.value;t.style.zIndex="auto",t.removeChild(this.e_editor),z.text.is_empty(i)||e.topic===i?this.render_node(t,e):this.jm.update_node(e.id,i)}this.e_panel.focus()}get_view_offset(){var e=this.layout.bounds;return{x:(this.size.w-e.e-e.w)/2,y:this.size.h/2}}resize(){this.graph.set_size(1,1),this.e_nodes.style.width="1px",this.e_nodes.style.height="1px",this.expand_size(),this._show()}_show(){this.graph.set_size(this.size.w,this.size.h),this.e_nodes.style.width=this.size.w+"px",this.e_nodes.style.height=this.size.h+"px",this.show_nodes(),this.show_lines(),this.jm.invoke_event_handle(v.resize,{data:[]})}zoom_in(e){return this.set_zoom(this.zoom_current+this.opts.zoom.step,e)}zoom_out(e){return this.set_zoom(this.zoom_current-this.opts.zoom.step,e)}set_zoom(e,t){if(e<this.opts.zoom.min||e>this.opts.zoom.max)return!1;let i=this.e_panel.getBoundingClientRect();if(e<1&&e<this.zoom_current&&this.size.w*e<i.width&&this.size.h*e<i.height)return!1;let n=t?{x:t.x-i.x,y:t.y-i.y}:{x:i.width/2,y:i.height/2},o=(this.e_panel.scrollLeft+n.x)*e/this.zoom_current-n.x,r=(this.e_panel.scrollTop+n.y)*e/this.zoom_current-n.y;this.zoom_current=e;for(var a=0;a<this.e_panel.children.length;a++)this.e_panel.children[a].style.zoom=e;return this._show(),this.e_panel.scrollLeft=o,this.e_panel.scrollTop=r,!0}show(e){d.debug("view.show"),this.expand_size(),this._show(),e&&this.center_node(this.jm.mind.root)}relayout(){this.expand_size(),this._show()}save_location(e){var t=e._data.view;t._saved_location={x:parseInt(t.element.style.left)-this.e_panel.scrollLeft,y:parseInt(t.element.style.top)-this.e_panel.scrollTop}}restore_location(e){var t=e._data.view;this.e_panel.scrollLeft=parseInt(t.element.style.left)-t._saved_location.x,this.e_panel.scrollTop=parseInt(t.element.style.top)-t._saved_location.y}clear_nodes(){var e=this.jm.mind;if(e!=null){var t=e.nodes,i=null;for(var n in t)(i=t[n])._data.view.element=null,i._data.view.expander=null;this.e_nodes.innerHTML=""}}show_nodes(){var e=this.jm.mind.nodes,t=null,i=null,n=null,o=null,r=this.get_view_offset();for(var a in e)i=(o=(t=e[a])._data.view).element,this.layout.is_visible(t)?(this.reset_node_custom_style(t),n=this.layout.get_node_point(t),o.abs_x=r.x+n.x,o.abs_y=r.y+n.y,i.style.left=r.x+n.x+"px",i.style.top=r.y+n.y+"px",i.style.display="",i.style.visibility="visible",this._show_expander(t,r)):(i.style.display="none",o.expander.style.display="none")}_show_expander(e,t){if(e.isroot)return;var i=e._data.view.expander;if(e.children.length==0)return i.style.display="none",void(i.style.visibility="hidden");let n=this._get_expander_text(e);_.t(i,n);let o=this.layout.get_expander_point(e);i.style.left=t.x+o.x+"px",i.style.top=t.y+o.y+"px",i.style.display="",i.style.visibility="visible"}_get_expander_text(e){let t=this.opts.expander_style?this.opts.expander_style.toLowerCase():"char";return t==="number"?e.children.length>99?"...":e.children.length:t==="char"?e.expanded?"-":"+":void 0}_default_node_render(e,t){this.opts.support_html?_.h(e,t.topic):_.t(e,t.topic)}_custom_node_render(e,t){this.opts.custom_node_render(this.jm,e,t)||this._default_node_render(e,t)}reset_node_custom_style(e){this._reset_node_custom_style(e._data.view.element,e.data)}_reset_node_custom_style(e,t){if("background-color"in t&&(e.style.backgroundColor=t["background-color"]),"foreground-color"in t&&(e.style.color=t["foreground-color"]),"width"in t&&(e.style.width=t.width+"px"),"height"in t&&(e.style.height=t.height+"px"),"font-size"in t&&(e.style.fontSize=t["font-size"]+"px"),"font-weight"in t&&(e.style.fontWeight=t["font-weight"]),"font-style"in t&&(e.style.fontStyle=t["font-style"]),"background-image"in t){var i=t["background-image"];if(i.startsWith("data")&&t.width&&t.height){var n=new Image;n.onload=function(){var o=_.c("canvas");if(o.width=e.clientWidth,o.height=e.clientHeight,o.getContext){o.getContext("2d").drawImage(this,2,2,e.clientWidth,e.clientHeight);var r=o.toDataURL();e.style.backgroundImage="url("+r+")"}},n.src=i}else e.style.backgroundImage="url("+i+")";e.style.backgroundSize="99%","background-rotation"in t&&(e.style.transform="rotate("+t["background-rotation"]+"deg)")}}restore_selected_node_custom_style(e){var t=e._data.view.element,i=e.data;"background-color"in i&&(t.style.backgroundColor=i["background-color"]),"foreground-color"in i&&(t.style.color=i["foreground-color"])}clear_selected_node_custom_style(e){var t=e._data.view.element;t.style.backgroundColor="",t.style.color=""}clear_lines(){this.graph.clear()}show_lines(){this.clear_lines();var e=this.jm.mind.nodes,t=null,i=null,n=null,o=null,r=this.get_view_offset();for(var a in e)(t=e[a]).isroot||this.layout.is_visible(t)&&(i=this.layout.get_node_point_in(t),n=this.layout.get_node_point_out(t.parent),o=t.data["leading-line-color"],this.graph.draw_line(n,i,r,o))}setup_canvas_draggable(e){if(this.opts.draggable=e,!this._initialized){let t,i,n=!1;this.opts.hide_scrollbars_when_draggable&&(this.e_panel.style="overflow: hidden"),_.on(this.container,"mousedown",o=>{this.opts.draggable&&(n=!0,t=o.clientX,i=o.clientY)}),_.on(this.container,"mouseup",()=>{n=!1}),_.on(this.container,"mousemove",o=>{this.opts.draggable&&n&&(this.e_panel.scrollBy(t-o.clientX,i-o.clientY),t=o.clientX,i=o.clientY)})}}center_node(e){if(!this.layout.is_visible(e))return d.warn("can not scroll to the node, because it is invisible"),!1;let t=e._data.view,i=this.e_panel.getBoundingClientRect(),n=t.abs_x+t.width/2,o=t.abs_y+t.height/2;return this.e_panel.scrollTo(n*this.zoom_current-i.width/2,o*this.zoom_current-i.height/2),!0}zoomIn(e){return d.warn("please use zoom_in instead"),this.zoom_in(e)}zoomOut(e){return d.warn("please use zoom_out instead"),this.zoom_out(e)}setZoom(e,t){return d.warn("please use set_zoom instead"),this.set_zoom(e,t)}}class K{constructor(e,t){this.jm=e,this.opts=t,this.mapping=t.mapping,this.handles=t.handles,this._newid=null,this._mapping={}}init(){for(var e in _.on(this.jm.view.e_panel,"keydown",this.handler.bind(this)),this.handles.addchild=this.handle_addchild,this.handles.addbrother=this.handle_addbrother,this.handles.editnode=this.handle_editnode,this.handles.delnode=this.handle_delnode,this.handles.toggle=this.handle_toggle,this.handles.up=this.handle_up,this.handles.down=this.handle_down,this.handles.left=this.handle_left,this.handles.right=this.handle_right,this.mapping)if(this.mapping[e]&&e in this.handles){let t=this.mapping[e];Array.isArray(t)||(t=[t]);for(let i of t)this._mapping[i]=this.handles[e]}typeof this.opts.id_generator=="function"?this._newid=this.opts.id_generator:this._newid=z.uuid.newid}enable_shortcut(){this.opts.enable=!0}disable_shortcut(){this.opts.enable=!1}handler(e){if(e.which==9&&e.preventDefault(),!this.jm.view.is_editing()){var t=e||event;if(!this.opts.enable)return!0;var i=t.keyCode+(t.metaKey<<13)+(t.ctrlKey<<12)+(t.altKey<<11)+(t.shiftKey<<10);i in this._mapping&&this._mapping[i].call(this,this.jm,e)}}handle_addchild(e,t){var i=e.get_selected_node();if(i){var n=this._newid();e.add_node(i,n,"New Node")&&(e.select_node(n),e.begin_edit(n))}}handle_addbrother(e,t){var i=e.get_selected_node();if(i&&!i.isroot){var n=this._newid();e.insert_node_after(i,n,"New Node")&&(e.select_node(n),e.begin_edit(n))}}handle_editnode(e,t){var i=e.get_selected_node();i&&e.begin_edit(i)}handle_delnode(e,t){var i=e.get_selected_node();i&&!i.isroot&&(e.select_node(i.parent),e.remove_node(i))}handle_toggle(e,t){var i=t||event,n=e.get_selected_node();n&&(e.toggle_node(n.id),i.stopPropagation(),i.preventDefault())}handle_up(e,t){var i=t||event,n=e.get_selected_node();if(n){var o=e.find_node_before(n);if(!o){var r=e.find_node_before(n.parent);r&&r.children.length>0&&(o=r.children[r.children.length-1])}o&&e.select_node(o),i.stopPropagation(),i.preventDefault()}}handle_down(e,t){var i=t||event,n=e.get_selected_node();if(n){var o=e.find_node_after(n);if(!o){var r=e.find_node_after(n.parent);r&&r.children.length>0&&(o=r.children[0])}o&&e.select_node(o),i.stopPropagation(),i.preventDefault()}}handle_left(e,t){this._handle_direction(e,t,h.left)}handle_right(e,t){this._handle_direction(e,t,h.right)}_handle_direction(e,t,i){var n=t||event,o=e.get_selected_node(),r=null;if(o){if(o.isroot){for(var a=o.children,l=[],p=0;p<a.length;p++)a[p].direction===i&&l.push(p);r=a[l[Math.floor((l.length-1)/2)]]}else if(o.direction===i){var f=(l=o.children).length;f>0&&(r=l[Math.floor((f-1)/2)])}else r=o.parent;r&&e.select_node(r),n.stopPropagation(),n.preventDefault()}}}const T={plugins:[]};function U(s){if(!(s instanceof A))throw new Error("can not register plugin, it is not an instance of Plugin");if(T.plugins.map(e=>e.name).includes(s.name))throw new Error("can not register plugin "+s.name+": plugin name already exist");T.plugins.push(s)}function V(s,e){_.w.setTimeout(function(){(function(t,i){T.plugins.forEach(n=>n.fn_init(t,i[n.name]))})(s,e)},0)}class A{constructor(e,t){if(!e)throw new Error("plugin must has a name");if(!t||typeof t!="function")throw new Error("plugin must has an init function");this.name=e,this.fn_init=t}}const m=class m{constructor(e){m.current=this,this.options=function(t){var i={};if(z.json.merge(i,W),z.json.merge(i,t),!i.container)throw new Error("the options.container should not be null or empty.");return i}(e),d.level(x[this.options.log_level]),this.version=g,this.initialized=!1,this.mind=null,this.event_handles=[],this.init()}init(){if(!this.initialized){this.initialized=!0;var e={mode:this.options.mode,hspace:this.options.layout.hspace,vspace:this.options.layout.vspace,pspace:this.options.layout.pspace,cousin_space:this.options.layout.cousin_space},t={container:this.options.container,support_html:this.options.support_html,engine:this.options.view.engine,hmargin:this.options.view.hmargin,vmargin:this.options.view.vmargin,line_width:this.options.view.line_width,line_color:this.options.view.line_color,line_style:this.options.view.line_style,draggable:this.options.view.draggable,hide_scrollbars_when_draggable:this.options.view.hide_scrollbars_when_draggable,node_overflow:this.options.view.node_overflow,zoom:this.options.view.zoom,custom_node_render:this.options.view.custom_node_render,expander_style:this.options.view.expander_style};this.data=new H(this),this.layout=new X(this,e),this.view=new F(this,t),this.shortcut=new K(this,this.options.shortcut),this.data.init(),this.layout.init(),this.view.init(),this.shortcut.init(),this._event_bind(),V(this,this.options.plugin)}}get_editable(){return this.options.editable}enable_edit(){this.options.editable=!0}disable_edit(){this.options.editable=!1}get_view_draggable(){return this.options.view.draggable}enable_view_draggable(){this.options.view.draggable=!0,this.view.setup_canvas_draggable(!0)}disable_view_draggable(){this.options.view.draggable=!1,this.view.setup_canvas_draggable(!1)}enable_event_handle(e){this.options.default_event_handle["enable_"+e+"_handle"]=!0}disable_event_handle(e){this.options.default_event_handle["enable_"+e+"_handle"]=!1}set_theme(e){var t=this.options.theme;this.options.theme=e||null,t!=this.options.theme&&(this.view.reset_theme(),this.view.reset_custom_style())}_event_bind(){this.view.add_event(this,"mousedown",this.mousedown_handle),this.view.add_event(this,"click",this.click_handle),this.view.add_event(this,"dblclick",this.dblclick_handle),this.view.add_event(this,"mousewheel",this.mousewheel_handle,!0)}mousedown_handle(e){if(this.options.default_event_handle.enable_mousedown_handle){var t=e.target||event.srcElement,i=this.view.get_binded_nodeid(t);i?this.view.is_node(t)&&this.select_node(i):this.select_clear()}}click_handle(e){if(this.options.default_event_handle.enable_click_handle){var t=e.target||event.srcElement;if(this.view.is_expander(t)){var i=this.view.get_binded_nodeid(t);i&&this.toggle_node(i)}}}dblclick_handle(e){if(this.options.default_event_handle.enable_dblclick_handle&&this.get_editable()){var t=e.target||event.srcElement;if(this.view.is_node(t)){var i=this.view.get_binded_nodeid(t);i&&this.begin_edit(i)}}}mousewheel_handle(e){if(this.options.default_event_handle.enable_mousewheel_handle&&e.ctrlKey){var t=e||event;t.preventDefault(),t.deltaY<0?this.view.zoom_in(t):this.view.zoom_out(t)}}begin_edit(e){if(!c.is_node(e)){var t=this.get_node(e);return t?this.begin_edit(t):(d.error("the node[id="+e+"] can not be found."),!1)}this.get_editable()?this.view.edit_node_begin(e):d.error("fail, this mind map is not editable.")}end_edit(){this.view.edit_node_end()}toggle_node(e){if(!c.is_node(e)){var t=this.get_node(e);return t?this.toggle_node(t):void d.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.toggle_node(e),this.view.relayout(),this.view.restore_location(e))}expand_node(e){if(!c.is_node(e)){var t=this.get_node(e);return t?this.expand_node(t):void d.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.expand_node(e),this.view.relayout(),this.view.restore_location(e))}collapse_node(e){if(!c.is_node(e)){var t=this.get_node(e);return t?this.collapse_node(t):void d.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.collapse_node(e),this.view.relayout(),this.view.restore_location(e))}expand_all(){this.layout.expand_all(),this.view.relayout()}collapse_all(){this.layout.collapse_all(),this.view.relayout()}expand_to_depth(e){this.layout.expand_to_depth(e),this.view.relayout()}_reset(){this.view.reset(),this.layout.reset(),this.data.reset()}_show(e){var t=e||u.node_array.example;this.mind=this.data.load(t),this.mind?(d.debug("data.load ok"),this.view.load(),d.debug("view.load ok"),this.layout.layout(),d.debug("layout.layout ok"),this.view.show(!0),d.debug("view.show ok"),this.invoke_event_handle(v.show,{data:[e]})):d.error("data.load error")}show(e){this._reset(),this._show(e)}get_meta(){return{name:this.mind.name,author:this.mind.author,version:this.mind.version}}get_data(e){var t=e||"node_tree";return this.data.get_data(t)}get_root(){return this.mind.root}get_node(e){return c.is_node(e)?e:this.mind.get_node(e)}add_node(e,t,i,n,o){if(this.get_editable()){var r=this.get_node(e),a=h.of(o);a===void 0&&(a=this.layout.calculate_next_child_direction(r));var l=this.mind.add_node(r,t,i,n,a);return l&&(this.view.add_node(l),this.layout.layout(),this.view.show(!1),this.view.reset_node_custom_style(l),this.expand_node(r),this.invoke_event_handle(v.edit,{evt:"add_node",data:[r.id,t,i,n,a],node:t})),l}return d.error("fail, this mind map is not editable"),null}insert_node_before(e,t,i,n,o){if(this.get_editable()){var r=this.get_node(e),a=h.of(o);a===void 0&&(a=this.layout.calculate_next_child_direction(r.parent));var l=this.mind.insert_node_before(r,t,i,n,a);return l&&(this.view.add_node(l),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(v.edit,{evt:"insert_node_before",data:[r.id,t,i,n,a],node:t})),l}return d.error("fail, this mind map is not editable"),null}insert_node_after(e,t,i,n,o){if(this.get_editable()){var r=this.get_node(e),a=h.of(o);a===void 0&&(a=this.layout.calculate_next_child_direction(r.parent));var l=this.mind.insert_node_after(r,t,i,n,a);return l&&(this.view.add_node(l),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(v.edit,{evt:"insert_node_after",data:[r.id,t,i,n,a],node:t})),l}return d.error("fail, this mind map is not editable"),null}remove_node(e){if(!c.is_node(e)){var t=this.get_node(e);return t?this.remove_node(t):(d.error("the node[id="+e+"] can not be found."),!1)}if(this.get_editable()){if(e.isroot)return d.error("fail, can not remove root node"),!1;var i=e.id,n=e.parent.id,o=this.get_node(n);return this.view.save_location(o),this.view.remove_node(e),this.mind.remove_node(e),this.layout.layout(),this.view.show(!1),this.view.restore_location(o),this.invoke_event_handle(v.edit,{evt:"remove_node",data:[i],node:n}),!0}return d.error("fail, this mind map is not editable"),!1}update_node(e,t){if(this.get_editable())if(z.text.is_empty(t))d.warn("fail, topic can not be empty");else{var i=this.get_node(e);if(i){if(i.topic===t)return d.info("nothing changed"),void this.view.update_node(i);i.topic=t,this.view.update_node(i),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(v.edit,{evt:"update_node",data:[e,t],node:e})}}else d.error("fail, this mind map is not editable")}move_node(e,t,i,n){if(this.get_editable()){var o=this.get_node(e),r=this.mind.move_node(o,t,i,n);r&&(this.view.update_node(r),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(v.edit,{evt:"move_node",data:[e,t,i,n],node:e}))}else d.error("fail, this mind map is not editable")}select_node(e){if(!c.is_node(e)){var t=this.get_node(e);return t?this.select_node(t):void d.error("the node[id="+e+"] can not be found.")}this.layout.is_visible(e)&&(this.mind.selected=e,this.view.select_node(e),this.invoke_event_handle(v.select,{evt:"select_node",data:[],node:e.id}))}get_selected_node(){return this.mind?this.mind.selected:null}select_clear(){this.mind&&(this.mind.selected=null,this.view.select_clear())}is_node_visible(e){return this.layout.is_visible(e)}scroll_node_to_center(e){if(c.is_node(e))this.view.center_node(e);else{var t=this.get_node(e);t?this.scroll_node_to_center(t):d.error("the node[id="+e+"] can not be found.")}}find_node_before(e){if(!c.is_node(e)){var t=this.get_node(e);return t?this.find_node_before(t):void d.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var i=null;if(e.parent.isroot)for(var n=e.parent.children,o=null,r=null,a=0;a<n.length;a++)r=n[a],e.direction===r.direction&&(e.id===r.id&&(i=o),o=r);else i=this.mind.get_node_before(e);return i}find_node_after(e){if(!c.is_node(e)){var t=this.get_node(e);return t?this.find_node_after(t):void d.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var i=null;if(e.parent.isroot){for(var n=e.parent.children,o=!1,r=null,a=0;a<n.length;a++)if(r=n[a],e.direction===r.direction){if(o){i=r;break}e.id===r.id&&(o=!0)}}else i=this.mind.get_node_after(e);return i}set_node_color(e,t,i){if(!this.get_editable())return d.error("fail, this mind map is not editable"),null;var n=this.mind.get_node(e);n&&(t&&(n.data["background-color"]=t),i&&(n.data["foreground-color"]=i),this.view.reset_node_custom_style(n))}set_node_font_style(e,t,i,n){if(!this.get_editable())return d.error("fail, this mind map is not editable"),null;var o=this.mind.get_node(e);o&&(t&&(o.data["font-size"]=t),i&&(o.data["font-weight"]=i),n&&(o.data["font-style"]=n),this.view.reset_node_custom_style(o),this.view.update_node(o),this.layout.layout(),this.view.show(!1))}set_node_background_image(e,t,i,n,o){if(!this.get_editable())return d.error("fail, this mind map is not editable"),null;var r=this.mind.get_node(e);r&&(t&&(r.data["background-image"]=t),i&&(r.data.width=i),n&&(r.data.height=n),o&&(r.data["background-rotation"]=o),this.view.reset_node_custom_style(r),this.view.update_node(r),this.layout.layout(),this.view.show(!1))}set_node_background_rotation(e,t){if(!this.get_editable())return d.error("fail, this mind map is not editable"),null;var i=this.mind.get_node(e);if(i){if(!i.data["background-image"])return d.error("fail, only can change rotation angle of node with background image"),null;i.data["background-rotation"]=t,this.view.reset_node_custom_style(i),this.view.update_node(i),this.layout.layout(),this.view.show(!1)}}resize(){this.view.resize()}add_event_listener(e){typeof e=="function"&&this.event_handles.push(e)}clear_event_listener(){this.event_handles=[]}invoke_event_handle(e,t){var i=this;_.w.setTimeout(function(){i._invoke_event_handle(e,t)},0)}_invoke_event_handle(e,t){for(var i=this.event_handles.length,n=0;n<i;n++)this.event_handles[n](e,t)}static show(e,t){d.warn("`jsMind.show(options, mind)` is deprecated, please use `jm = new jsMind(options); jm.show(mind);` instead");var i=new m(e);return i.show(t),i}};j(m,"mind",k),j(m,"node",c),j(m,"direction",h),j(m,"event_type",v),j(m,"$",_),j(m,"plugin",A),j(m,"register_plugin",U),j(m,"util",z);let E=m;return E})})(P);var B=P.exports;const Z=J(B),te=G({__proto__:null,default:Z},[B]);export{te as j};
